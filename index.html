<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>World Meals Explorer</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
</head>
<body>
  <header>
    <h1>üåé World Meals Explorer</h1>
    <p>Click on a country to discover its national dishes!</p>
  </header>

  <main>
    <div id="map"></div>
    <div id="dishes"></div>
  </main>

  <footer>
    <p>Hackathon Project - Explore global cuisine üåç</p>
  </footer>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([20, 0], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const countries = [
      { name: 'Canada', lat: 56, lng: -106 },
      { name: 'Italy', lat: 42.5, lng: 12.5 },
      { name: 'Japan', lat: 36, lng: 138 }
    ];

    countries.forEach(c => {
      L.marker([c.lat, c.lng]).addTo(map)
        .bindPopup(c.name)
        .on('click', () => showDishes(c.name));
    });

    async function showDishes(country) {
      const dishesDiv = document.getElementById('dishes');
      dishesDiv.innerHTML = '<p class="loading">Loading dishes...</p>';

      try {
        const res = await fetch(`https://www.themealdb.com/api/json/v1/1/filter.php?a=${country}`);
        const data = await res.json();

        if (data.meals) {
          dishesDiv.innerHTML = '';
          for (let meal of data.meals) {
            const imgRes = await fetch(`/image?query=${encodeURIComponent(meal.strMeal)}`);
            const imgData = await imgRes.json();

            const mealDiv = document.createElement('div');
            mealDiv.className = 'meal-card';
            mealDiv.innerHTML = `
              <img src="${imgData.url}" alt="${meal.strMeal}">
              <h3>${meal.strMeal}</h3>
              <p><strong>Category:</strong> ${meal.strCategory}</p>
              <p><strong>Area:</strong> ${meal.strArea}</p>
            `;
            dishesDiv.appendChild(mealDiv);
          }
        } else {
          dishesDiv.innerHTML = '<p class="loading">No dishes found for this country.</p>';
        }
      } catch (err) {
        dishesDiv.innerHTML = '<p class="loading">Error fetching dishes.</p>';
        console.error(err);
      }
    }
  </script>
</body>
</html>
